## פרק 8 בניית פיצ’ר מקצה לקצה עם סוכן
### ניהול State של משימה
בניית פיצ’ר מקצה לקצה היא לא אוסף של שינויים.
זו תנועה.
יש התחלה.
יש אמצע.
ויש נקודה שבה צריך לעצור ולהגיד: זה הושלם.
כשעובדים לבד, ה-State של המשימה נמצא בראש.
כשעובדים עם סוכן קוד, הוא חייב להיות ברור גם לו.
בלי ניהול State, הסוכן לא יודע:
•	מה כבר טופל
•	מה עדיין פתוח
•	ואיזה שינוי שייך לאיזה שלב
התוצאה היא ערבוב.
קוד שנוגע בכמה דברים במקביל.
תיקונים שנכנסים מוקדם מדי.
או השלמות שמתפספסות כי “כבר עברנו הלאה”.
ניהול State לא אומר לנהל רשימה מסודרת של משימות.
הוא אומר לשמור רצף ברור.
מה היעד הנוכחי.
מתי עוברים לשלב הבא.
ואיזה חלקים עדיין אסור לגעת בהם.
מתכנת שמכוון עבודה לא נותן לסוכן “לזרום” בין שלבים.
הוא עוצר בין נקודות, מוודא סגירה, ורק אז מתקדם.
וברגע שעושים את זה,
פיצ’רים גדולים מפסיקים להתפרק בדרך,
והופכים לתהליך שאפשר לשלוט בו.

### שמירה על חוזים קיימים
פיצ’ר חדש כמעט אף פעם לא עומד לבד.
הוא יושב על קוד קיים, API קיים, והתנהגות שכבר נסמכת עליה במקומות אחרים.
החוזים האלה לא תמיד כתובים.
לפעמים הם טסטים.
לפעמים קוד צרכן.
ולפעמים פשוט ציפייה שקטה של מערכת אחרת.
סוכן קוד לא תמיד מודע לחוזים האלה.
אם לא אומרים לו במפורש מה אסור לשבור,
הוא יבחר פתרון שעובד מקומית, גם אם הוא משנה התנהגות קיימת.
ופה האחריות שלך קריטית.
שמירה על חוזים לא אומרת לקפוא במקום.
היא אומרת לדעת מה קיים לפני שמרחיבים.
איזה API לא משתנה.
איזו חתימה חייבת להישאר.
ואיזה התנהגות נבדקת במקום אחר.
מתכנת שמכוון עבודה מוודא שהפיצ’ר החדש משתלב,
לא דורך.
וברגע שמסמנים את החוזים מראש,
הסוכן יכול לעבוד חופשי יותר בתוך הגבולות,
בלי לפרק דברים בדרך.
 
### שילוב בדיקות ודוקומנטציה
פיצ’ר שלא נבדק ולא מתועד הוא חוב עתידי.
גם אם הוא עובד היום.
בעבודה עם סוכן קוד, יש פיתוי לדחות את הבדיקות והדוקומנטציה לסוף.
קודם “שיעבוד”,
אחר כך נסדר.
אבל כשמגיעים לסוף,
ההקשר כבר התפזר.
והסוכן כבר עבר למשהו אחר.
שילוב בדיקות ודוקומנטציה צריך לקרות תוך כדי.
לא כשלב נפרד,
אלא כחלק מהבנייה.
בדיקות מבהירות כוונה.
דוקומנטציה מבהירה שימוש.
שתיהן עוזרות לסוכן להבין אם הוא בכיוון.
מתכנת שמכוון עבודה לא שואל רק “האם זה עובד”,
אלא גם “האם ברור למה זה עובד”.
וברגע שמכניסים את השאלות האלה לתוך התהליך,
הפיצ’ר נהיה יציב יותר,
וגם קל יותר להמשיך ממנו הלאה.
 
### איך מוודאים שלא נשבר משהו בדרך
הבעיה האמיתית בפיצ’רים חדשים היא לא שהם לא עובדים.
הבעיה היא שהם עובדים, אבל שוברים משהו אחר.
בעבודה עם סוכן קוד, הסיכון הזה גדל.
לא כי הוא רשלן,
אלא כי הוא מתקדם מהר ורואה הרבה קוד בו זמנית.
כדי לוודא שלא נשבר משהו בדרך, צריך לעצור בכוונה.
לא רק כשהבדיקות נכשלות,
אלא גם כשהן עוברות.
לעצור ולשאול:
•	איזה התנהגות קיימת השתנתה
•	איזה קוד הושפע בלי שהתכוונו
•	ואיזה חלקים במערכת לא בדקנו בכלל
בדיקות אוטומטיות עוזרות,
אבל הן לא מספיקות לבד.
מתכנת שמכוון עבודה משלב בדיקות טכניות
עם בדיקות חשיבה.
האם השינוי הגיוני במבט רחב.
האם הוא משתלב בזרימה הקיימת.
והאם מישהו אחר בצוות יופתע ממנו.
ברגע שעובדים כך,
פיצ’ר חדש מפסיק להיות הימור,
והופך לתוספת מבוקרת.
 
### דוגמה מלאה: פיצ’ר אמיתי מתחילתו ועד סופו
כאן כל העקרונות מתחברים.
לא דוגמה סטרילית.
לא Repo חדש.
פיצ’ר אמיתי, במערכת קיימת, עם אילוצים, חוזים וציפיות.
העבודה מתחילה בהגדרת המטרה.
לא מה לשנות, אלא למה השינוי נדרש.
מה נחשב הצלחה, ומה ייחשב כישלון גם אם הקוד ירוץ.
אחר כך מגיע שלב ההכוונה.
איזה אזור במערכת רלוונטי.
איפה לא נוגעים.
ואיזה חלקים דורשים זהירות מיוחדת.
הסוכן מתקדם שלב-שלב.
מבין.
מציע.
מבצע.
בכל נקודה יש עצירה.
בדיקת הבנה.
בדיקת השפעה.
ולפעמים חזרה אחורה.
הפיצ’ר לא נבנה בריצה אחת.
הוא נבנה כרצף החלטות.
ובסוף, כשהכול עובד, יש בדיקות.
יש דוקומנטציה.
ויש תחושה ברורה שלא רק הבעיה נפתרה,
אלא שהמערכת נשארה יציבה.
זו לא קסם.
זו שיטה.
ומתכנת שמכוון עבודה מבין שזו הדרך היחידה לבנות פיצ’רים גדולים עם סוכן,
בלי לאבד שליטה בדרך.
